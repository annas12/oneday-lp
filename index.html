<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Speech Indonesia - ElevenLabs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .voice-card {
            transition: all 0.3s ease;
        }
        .voice-card:hover {
            transform: translateY(-2px);
        }
        .voice-card.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .preview-loading {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">üé§ Text to Speech</h1>
            <p class="text-gray-600 text-sm">Powered by ElevenLabs AI</p>
        </div>

        <!-- Configuration Notice -->
        <div id="configNotice" class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
            <p class="text-xs text-green-800">
                <strong>‚úÖ Connected:</strong> Terhubung dengan Cloudflare Worker Anda
            </p>
        </div>

        <!-- Text Input -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Masukkan Teks</label>
            <textarea 
                id="textInput" 
                placeholder="Ketik teks yang ingin diubah menjadi suara..."
                class="w-full h-24 p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >Halo, ini adalah demo text to speech menggunakan ElevenLabs AI. Suara ini sangat natural dan realistis.</textarea>
        </div>

        <!-- Voice Selection -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-3">Pilih Suara</label>
            
            <!-- Selected Voice Display -->
            <div id="selectedVoiceDisplay" class="hidden mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div id="selectedVoiceIcon" class="text-2xl">üé≠</div>
                        <div>
                            <div id="selectedVoiceName" class="font-medium text-sm text-gray-800">Pilih Suara</div>
                            <div id="selectedVoiceCategory" class="text-xs text-gray-500">AI Voice</div>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button id="previewSelectedBtn" class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                            ‚ñ∂Ô∏è
                        </button>
                        <button id="changeVoiceBtn" class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                            Ganti
                        </button>
                    </div>
                </div>
            </div>

            <!-- Voice Grid (Hidden after selection) -->
            <div id="voiceGrid" class="grid grid-cols-2 gap-2">
                <div class="text-center text-gray-500 py-4 col-span-2">
                    <div class="animate-spin w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-2"></div>
                    <p class="text-sm">Memuat suara...</p>
                </div>
            </div>
        </div>

        <!-- Voice Settings -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-3">Pengaturan Suara</label>
            
            <!-- Stability -->
            <div class="mb-3">
                <label class="block text-xs text-gray-600 mb-1">Stabilitas</label>
                <div class="flex items-center space-x-3">
                    <span class="text-xs text-gray-500">Variasi</span>
                    <input 
                        type="range" 
                        id="stabilityRange" 
                        min="0" 
                        max="1" 
                        step="0.1" 
                        value="0.5"
                        class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                    >
                    <span class="text-xs text-gray-500">Stabil</span>
                </div>
                <div class="text-center mt-1">
                    <span id="stabilityValue" class="text-xs text-blue-600 font-medium">0.5</span>
                </div>
            </div>

            <!-- Similarity Boost -->
            <div>
                <label class="block text-xs text-gray-600 mb-1">Kejelasan</label>
                <div class="flex items-center space-x-3">
                    <span class="text-xs text-gray-500">Low</span>
                    <input 
                        type="range" 
                        id="clarityRange" 
                        min="0" 
                        max="1" 
                        step="0.1" 
                        value="0.5"
                        class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                    >
                    <span class="text-xs text-gray-500">High</span>
                </div>
                <div class="text-center mt-1">
                    <span id="clarityValue" class="text-xs text-blue-600 font-medium">0.5</span>
                </div>
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="space-y-3 mb-4">
            <button 
                id="generateBtn"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2"
            >
                <span id="generateIcon">üéµ</span>
                <span id="generateText">Generate & Download MP3</span>
            </button>
            
            <audio id="audioPlayer" controls class="w-full hidden"></audio>
            <audio id="previewPlayer" class="hidden"></audio>
        </div>

        <!-- Status -->
        <div id="status" class="text-center text-sm text-gray-500 hidden"></div>

        <!-- Usage Info -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4">
            <p class="text-xs text-blue-800">
                <strong>ElevenLabs:</strong> 10,000 karakter gratis per bulan. Suara AI berkualitas tinggi dan natural.
            </p>
        </div>
    </div>

    <script>
        // ‚úÖ TERHUBUNG DENGAN CLOUDFLARE WORKER ANDA
        const WORKER_URL = 'https://tts-indonesia-api.annasmashuri97.workers.dev';
        
        let selectedVoice = null;
        let availableVoices = [];

        // Initialize the app
        async function init() {
            setupEventListeners();
            await loadVoices();
            checkConfiguration();
        }

        // Check if worker URL is configured
        function checkConfiguration() {
            // Worker URL sudah dikonfigurasi dengan benar
            document.getElementById('configNotice').style.display = 'block';
        }

        // Load voices from ElevenLabs
        async function loadVoices() {
            try {
                const response = await fetch(`${WORKER_URL}/voices`);
                const data = await response.json();
                
                if (data.voices) {
                    availableVoices = data.voices;
                    populateVoiceGrid();
                } else {
                    throw new Error('No voices received');
                }
            } catch (error) {
                console.error('Error loading voices:', error);
                showStatus('Gagal memuat suara. Periksa konfigurasi Worker.', 'error');
                showFallbackVoices();
            }
        }

        // Show fallback voices if API fails
        function showFallbackVoices() {
            const fallbackVoices = [
                { voice_id: 'demo', name: 'Demo Voice', category: 'generated' }
            ];
            availableVoices = fallbackVoices;
            populateVoiceGrid();
        }

        // Create voice selection grid
        function populateVoiceGrid() {
            const grid = document.getElementById('voiceGrid');
            grid.innerHTML = '';
            
            availableVoices.forEach((voice, index) => {
                const container = document.createElement('div');
                container.className = 'voice-button bg-gray-50 hover:bg-blue-50 border border-gray-200 hover:border-blue-300 rounded-lg p-3 transition-all duration-200';
                container.dataset.voiceId = voice.voice_id;
                
                const gender = voice.labels?.gender || 'unknown';
                const icon = gender === 'female' ? 'üë©' : gender === 'male' ? 'üë®' : 'üé≠';
                
                container.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2 flex-1 min-w-0 cursor-pointer select-voice-area">
                            <div class="text-lg">${icon}</div>
                            <div class="flex-1 min-w-0">
                                <div class="font-medium text-xs text-gray-800 truncate">${voice.name}</div>
                                <div class="text-xs text-gray-500 truncate">${voice.category || 'AI Voice'}</div>
                            </div>
                        </div>
                        <button class="preview-btn ml-2 text-blue-600 hover:text-blue-700 text-xs font-medium px-2 py-1 rounded border border-blue-200 hover:border-blue-300 transition-colors" data-voice-id="${voice.voice_id}" data-voice-name="${voice.name}">
                            ‚ñ∂Ô∏è
                        </button>
                    </div>
                `;
                
                // Add click event for voice selection
                const selectArea = container.querySelector('.select-voice-area');
                selectArea.addEventListener('click', () => selectVoice(voice));
                
                // Add click event for preview
                const previewBtn = container.querySelector('.preview-btn');
                previewBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    previewVoice(voice.voice_id, voice.name, previewBtn);
                });
                
                grid.appendChild(container);
            });

            // Select first voice by default
            if (availableVoices.length > 0) {
                selectVoice(availableVoices[0]);
            }
        }

        // Preview voice function
        async function previewVoice(voiceId, voiceName, buttonElement) {
            const previewText = "Hello, this is a preview of my voice.";
            
            // Show loading state
            const originalText = buttonElement.textContent;
            buttonElement.textContent = '‚è≥';
            buttonElement.classList.add('preview-loading');
            
            try {
                const response = await fetch(`${WORKER_URL}/tts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: previewText,
                        voice_id: voiceId,
                        stability: 0.5,
                        similarity_boost: 0.5
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);

                // Play preview
                const previewPlayer = document.getElementById('previewPlayer');
                previewPlayer.src = audioUrl;
                previewPlayer.play();

                showStatus(`Preview: ${voiceName}`, 'info');

            } catch (error) {
                console.error('Error previewing voice:', error);
                showStatus('Gagal preview suara', 'error');
            } finally {
                // Reset button state
                buttonElement.textContent = originalText;
                buttonElement.classList.remove('preview-loading');
            }
        }

        // Select a voice
        function selectVoice(voice) {
            selectedVoice = voice;
            
            // Update selected voice display
            const gender = voice.labels?.gender || 'unknown';
            const icon = gender === 'female' ? 'üë©' : gender === 'male' ? 'üë®' : 'üé≠';
            
            document.getElementById('selectedVoiceIcon').textContent = icon;
            document.getElementById('selectedVoiceName').textContent = voice.name;
            document.getElementById('selectedVoiceCategory').textContent = voice.category || 'AI Voice';
            
            // Show selected voice display and hide grid
            document.getElementById('selectedVoiceDisplay').classList.remove('hidden');
            document.getElementById('voiceGrid').classList.add('hidden');
        }

        // Show voice grid again
        function showVoiceGrid() {
            document.getElementById('selectedVoiceDisplay').classList.add('hidden');
            document.getElementById('voiceGrid').classList.remove('hidden');
        }

        // Setup event listeners
        function setupEventListeners() {
            const stabilityRange = document.getElementById('stabilityRange');
            const stabilityValue = document.getElementById('stabilityValue');
            const clarityRange = document.getElementById('clarityRange');
            const clarityValue = document.getElementById('clarityValue');
            const generateBtn = document.getElementById('generateBtn');
            const changeVoiceBtn = document.getElementById('changeVoiceBtn');
            const previewSelectedBtn = document.getElementById('previewSelectedBtn');

            // Stability control
            stabilityRange.addEventListener('input', (e) => {
                stabilityValue.textContent = parseFloat(e.target.value).toFixed(1);
            });

            // Clarity control
            clarityRange.addEventListener('input', (e) => {
                clarityValue.textContent = parseFloat(e.target.value).toFixed(1);
            });

            // Generate button
            generateBtn.addEventListener('click', generateSpeech);

            // Change voice button
            changeVoiceBtn.addEventListener('click', showVoiceGrid);

            // Preview selected voice button
            previewSelectedBtn.addEventListener('click', () => {
                if (selectedVoice) {
                    previewVoice(selectedVoice.voice_id, selectedVoice.name, previewSelectedBtn);
                }
            });
        }

        // Generate speech
        async function generateSpeech() {
            const textInput = document.getElementById('textInput');
            const generateBtn = document.getElementById('generateBtn');
            const generateIcon = document.getElementById('generateIcon');
            const generateText = document.getElementById('generateText');
            const audioPlayer = document.getElementById('audioPlayer');

            const text = textInput.value.trim();
            if (!text) {
                showStatus('Silakan masukkan teks terlebih dahulu', 'error');
                return;
            }

            if (!selectedVoice) {
                showStatus('Silakan pilih suara terlebih dahulu', 'error');
                return;
            }

            // Show loading state
            generateBtn.classList.add('loading');
            generateIcon.textContent = '‚è≥';
            generateText.textContent = 'Generating...';
            showStatus('Sedang membuat audio...', 'info');

            try {
                const stability = parseFloat(document.getElementById('stabilityRange').value);
                const similarity_boost = parseFloat(document.getElementById('clarityRange').value);

                const response = await fetch(`${WORKER_URL}/tts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        voice_id: selectedVoice.voice_id,
                        stability: stability,
                        similarity_boost: similarity_boost
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);

                // Show audio player
                audioPlayer.src = audioUrl;
                audioPlayer.classList.remove('hidden');
                audioPlayer.play();

                showStatus('Audio berhasil dibuat! Klik kanan pada player untuk download.', 'success');

            } catch (error) {
                console.error('Error generating speech:', error);
                showStatus('Gagal membuat audio. Periksa koneksi dan konfigurasi.', 'error');
            } finally {
                // Reset button state
                generateBtn.classList.remove('loading');
                generateIcon.textContent = 'üéµ';
                generateText.textContent = 'Generate & Download MP3';
            }
        }

        // Show status message
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.className = `text-center text-sm ${
                type === 'error' ? 'text-red-600' : 
                type === 'success' ? 'text-green-600' : 
                type === 'warning' ? 'text-yellow-600' : 
                'text-blue-600'
            }`;
            status.textContent = message;
            status.classList.remove('hidden');
            
            setTimeout(() => {
                status.classList.add('hidden');
            }, 5000);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98055dd4e0dd445e',t:'MTc1ODA3ODE2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
